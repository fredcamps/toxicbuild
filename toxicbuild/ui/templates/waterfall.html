{% extends "base.html" %}

{% block main_area %}
{% include "step_details_modal.html" %}
<table>
  <tbody class="waterfall-table">
    <tr class="waterfall-row">
      <td class="buildsets-column placeholder">
	<ul>
	  <li class="buildset buildset-placeholder">
	    buildsets
	  </li>
	</ul>
      </td>
      {% for builder in builders %}
      <td class="builders-column">
	<ul class="">
	  <li class="builder builder-{{builder.status}}" id="{{builder.id}}">
	    {{builder.name}}
	  </li>
	</ul>
      </td>
      {% end %}
    </tr>
    {% for buildset in buildsets %}
    <tr class="waterfall-row">
      <td class="buildsets-column">
	<ul class="">
	  <li class="buildset" id="buildset-{{buildset.id}}">
	    commit: {{buildset.commit[:8]}}<br/>
	    branch: {{buildset.branch}}<br/>
	  </li>
	</ul>
      </td>
      {% for i, build in enumerate(ordered_builds(buildset.builds)) %}
      <td class="builder-column">
	{% for ending in get_ending(build, i, builders)%}
   	  {{ending}}
	{% end %}
	<ul>
	  <li class="step step-{{build.status}}">
	    Build - {{build.status}}
	  </li>
	  {% for step in build.steps %}
	  <li class="step step-{{step.status}}">
	    {{step.name}} - {{step.status}}
	    <button type="button" class="btn btn-step-details btn-sm"
		    data-toggle="modal"
		    data-target="#stepDetailsModal"
		    data-dismiss="modal"
		    data-step-command="{{step.command}}"
		    data-step-output="{{step.output}}"
		    data-step-status="{{step.status}}"
		    data-step-start="{{step.started}}"
		    data-step-end="{{step.finished}}">
	      details
	    </button>

	  </li>
	  {% end %}
	</ul>
      </td>
      {% end %}
    </tr>
    {% end %}
  </tbody>
</table>
{% end %}

{% block js_bottom %}
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="{{static_url}}toxicbuild/js/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="{{static_url}}toxicbuild/js/bootstrap.min.js"></script>
<script src="{{static_url}}toxicbuild/js/waterfall.js"></script>
{% end %}
