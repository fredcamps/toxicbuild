{% extends "base.html" %}

{% block main_area %}

<div class="page-header">
  <h4>Repositories</h4>

  <!-- Button trigger modal add repository -->
  <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#repoModal">
    Add repo
  </button>
</div>

{% include "repository_modal.html" %}

{% include "start_build_modal.html" %}

<div class="row main-row">
  <table class="table">
    <thead>
      <th>Name</th>
      <th>URL</th>
      <th>Status</th>
    </thead>
    <tbody id="tbody-repos">
      {% for repo in repos %}
      <tr id="repo-row-{{repo.name}}">
	<td>
	  <button type="button" class="btn btn-primary btn-xs"
		  data-toggle="modal" data-target="#repoModal"
		  data-repo-name="{{repo.name}}" data-repo-url="{{repo.url}}"
		  data-repo-update-seconds="{{repo.update_seconds}}"
		  data-repo-vcs-type="{{repo.vcs_type}}"
		  data-repo-id="{{repo.id}}">
	    {{repo.name}}
	  </button>
	</td>
	<td>{{repo.url}}</td>
	<td>
	  <form action="/waterfall/{{repo.name}}">
	    <button type="submit" class="btn btn-xs btn-{{get_btn_class(repo.status)}} btn-status">{{repo.status}}
	    </button>
	  </form>
	</td>
      {% end %}
    </tbody>
  </table>
</div>


<div class="page-header">
  <h4>Slaves</h4>
  <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#slaveModal">
    Add slave
  </button>
</div>

{% include "slave_modal.html" %}

<div class="row main-row">
  <table class="table">
    <thead>
      <th>Name</th>
      <th>Host</th>
      <th>Port</th>
    </thead>
    <tbody id="tbody-slaves">
      {% for slave in slaves %}
      <tr id="slave-row-{{slave.name}}">
	<td>
	  <button type="button" class="btn btn-primary btn-xs"
		  data-toggle="modal"
		  data-target="#slaveModal"
		  data-slave-name="{{slave.name}}"
		  data-slave-host="{{slave.host}}"
		  data-slave-port="{{slave.port}}">
	    {{slave.name}}
	  </button>
	</td>
	<td>{{slave.host}}</td>
	<td>{{slave.port}}</td>
      </tr>
      {% end %}
    </tbody>
  </table>
</div>

{% end %}

{% block js_bottom %}
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="{{static_url}}toxicbuild/js/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="{{static_url}}toxicbuild/js/bootstrap.min.js"></script>
<script src="{{static_url}}toxicbuild/js/validator.js"></script>
<script src="{{static_url}}toxicbuild/js/utils.js"></script>
<script src="{{static_url}}toxicbuild/js/repository.js"></script>
<script src="{{static_url}}toxicbuild/js/slave.js"></script>
<script src="{{static_url}}toxicbuild/js/main.js"></script>

<script>
  {% autoescape None %}
  RepositoryManager.init({{[r.to_dict() for r in repos]}})
</script>

{% end %}
